<section class="contents-right" style="position:relative;z-index:0;">
  <div class="cnt-top">
    <h2 class="cnt-tit">일정</h2>
    <div class="pos-right">
      <v-btn fab text small color="grey darken-2">
        <v-icon>mdi-cog-outline</v-icon>
      </v-btn>
    </div>
  </div>
  <!-- start: 상단 컨트롤러 -->
  <v-sheet height="64">
    <v-toolbar flat color="white">
      <v-btn fab text x-small outlined color="grey darken-2" @click="prev">
        <v-icon small>mdi-chevron-left</v-icon>
      </v-btn>
      <v-btn class="ml-2" fab text x-small outlined color="grey darken-2" @click="next">
        <v-icon small>mdi-chevron-right</v-icon>
      </v-btn>
      <v-toolbar-title v-if="$refs.calendar" class="ml-4 ft-bold">{{ $refs.calendar.title }}</v-toolbar-title>
      <v-spacer></v-spacer>
      <v-btn rounded depressed class="mr-4" @click="setToday">오늘</v-btn>
      <v-menu bottom right>
        <template v-slot:activator="{ on, attrs }">
          <v-btn
                  rounded
                  outlined
                  v-bind="attrs"
                  v-on="on"
                  min-width="100px">
            <span>{{ typeToLabel[type] }}</span>
            <v-icon right>mdi-menu-down</v-icon>
          </v-btn>
        </template>
        <v-list>
          <v-list-item @click="type = 'day'">
            <v-list-item-title>일간</v-list-item-title>
          </v-list-item>
          <v-list-item @click="type = 'week'">
            <v-list-item-title>주</v-list-item-title>
          </v-list-item>
          <v-list-item @click="type = 'month'">
            <v-list-item-title>월간</v-list-item-title>
          </v-list-item>
          <v-list-item @click="type = '4day'">
            <v-list-item-title>4 days</v-list-item-title>
          </v-list-item>
        </v-list>
      </v-menu>
    </v-toolbar>
  </v-sheet>
  <!-- end: 상단 컨트롤러 -->

  <!-- start: 캘린더 -->
  <v-sheet height="674">
    <!--
           @click:more="viewDay"
            @click:date="viewDay"
            @click:event="showEvent"
            @click:more="viewMoreDay"
            @mousedown:event="startDrag"
            @mousedown:time="startTime"
            @mousemove:time="mouseMove"
            @mouseup:time="endDrag"
            @mouseleave.native="cancelDrag"
            -->
    <v-calendar
            ref="calendar"
            v-model="calendarModel"
            color="primary"
            :events="scheduleEvents"
            :event-color="getEventColor"
            :type="type"
            :weekdays="weekdays"
            :weekday-format="getDay"
            :day-format="(timestamp) => new Date(timestamp.date).getDate()"
            :month-format="(timestamp)=> (new Date(timestamp.date).getMonth()+1)+'월' "
            @change="updateRange"
            @click:event="showEvent"
    >
      <template v-slot:event="{ event, timed, eventSummary }">
        <div class="v-event-draggable" v-html="eventSummary()"></div>
        <div v-if="timed" class="v-event-drag-bottom" @mousedown.stop="extendBottom(event)"></div>
      </template>
    </v-calendar>

    <!-- start: 상세내역 팝업 -->
    <!--<v-menu
            v-model="selectedOpen"
            :close-on-content-click="false"
            :activator="selectedElement"
            offset-x>
      <v-card color="grey lighten-4" min-width="350px" flat>
        <v-toolbar :color="selectedEvent.color" dark>
          <v-btn icon><v-icon>mdi-pencil</v-icon></v-btn>
          <v-toolbar-title v-html="selectedEvent.name"></v-toolbar-title>
          <v-spacer></v-spacer>
          <v-btn icon><v-icon>mdi-heart</v-icon></v-btn>
          <v-btn icon><v-icon>mdi-dots-vertical</v-icon></v-btn>
        </v-toolbar>
        <v-card-text><span v-html="selectedEvent.details"></span></v-card-text>
        <v-card-actions>
          <v-btn text color="secondary" @click="selectedOpen = false">Cancel</v-btn>
        </v-card-actions>
      </v-card>
    </v-menu>-->
    <!-- end: 상세내역 팝업 -->

  </v-sheet>
  <!-- end: 캘린더 -->

  <div class="add-schedule">
    <a href="" class="add-schedule-btn" @click.prevent="addScheduleOpen"></a>
  </div>

  <!-- start: 공통 팝업 / 파일명 : W.4.5.3.3.4.2 (일정 만들기) (4.5.3.3.1 ~ 4.5.3.3.4.2) isPopup=false;loopRangeCheck = false-->
  <add-schedule :is-open="isOpenAddSch"></add-schedule>
  <!-- end: 공통 팝업 -->

  <!-- start: 공통 팝업 / 파일명 : W.4.5.3.4 (일정 상세) -->
  <transition name="modal">
    <modal v-if="selectedOpen" size="600px" body-padding="0" footerPadding="0" @modalClose="selectedOpen=false">
      <div slot="header">
        <!-- header custom coding-->
        <p class="popup-header-tit">{{ selectedEvent.name }}</p>

        <div class="popup-btn">
          <button type="button" class="btn only-ico-btn sm bookmark active"></button>

          <v-menu bottom nudge-right="" min-width="200px" offset-x>
            <template v-slot:activator="{ on, attrs }">
              <button type="button"
                      class="list-popup-btn ml-4"
                      v-bind="attrs"
                      v-on="on"><img :src="require('@/assets/images/more.svg')" alt="">
              </button>
              <!--<v-btn
                      rounded
                      outlined
                      v-bind="attrs"
                      v-on="on"
                      min-width="100px">
                <span>{{ typeToLabel[type] }}</span>
                <v-icon right>mdi-menu-down</v-icon>
              </v-btn>-->
            </template>
            <v-list>
              <v-list-item @click="">
                <v-list-item-title>일정 수정</v-list-item-title>
              </v-list-item>
              <v-list-item @click="">
                <v-list-item-title>일정 보관</v-list-item-title>
              </v-list-item>
              <v-list-item @click="">
                <v-list-item-title>일정 삭제</v-list-item-title>
              </v-list-item>
            </v-list>
          </v-menu>
          <!--<div class="list-popup mgl-20">
            <button type="button" class="list-popup-btn"><img :src="require('@/assets/images/more.svg')" alt="">
            </button>
            <div class="list-popup-menu pos-right active" style="transform:translate3d(42px, 0,0);">
              <a href="" class="list-popup-item">일정 수정</a>
              <a href="" class="list-popup-item">일정 보관</a>
              <a href="" class="list-popup-item">일정 삭제</a>
            </div>
          </div>-->
        </div>
      </div>
      <div slot="body">
        <!-- body custom coding-->
        <div class="scroll-body" style="height:70vh;">
          <div class="popup-form">
            <div class="popup-form-top">
              <div class="form-item pd-desc">
                <ul class="feed-state clearfix">
                  <li class="state-item"><p class="period">{{ getFullDay( selectedEvent.start) }} - {{ getFullDay( selectedEvent.end ) }}</p></li>
                  <li class="state-item"><p class="repeat">{{ selectedEvent.repeat }}</p></li>
                </ul>
              </div>

              <div class="form-item post-classes selected"> <!-- class 선택 시 form-item에 selected 추가됨 -->
                <p>
                  <span class="icon"><img :src="getProfileImg(myClassHomeModel.image_url)" class="icon-img" alt=""></span>
                  <span class="gr-name">{{ myClassHomeModel.g_name }}</span>
                  <strong class="cls-name">{{ myClassHomeModel.name }}</strong>
                </p>

                <p class="post-writer" :class="{ 'manager':myClassHomeModel.me.level ===1}">{{ myClassHomeModel.me.nickname }}</p>
              </div>
            </div>
          </div>

          <div class="popup-feed-detail pdb-40">
            <div class="fd-cnt">
              <p class="fd-txt">
                {{ selectedEvent.details }}
              </p>

              <div class="fd-inner">
                <ul class="img-list clearfix">
                  <li><a href=""><img :src="require('@/assets/images/pic.png')" alt=""></a></li>
                  <li><a href=""><img :src="require('@/assets/images/pic2.png')" alt=""></a></li>
                  <li><a href=""><img :src="require('@/assets/images/pic3.png')" alt=""></a></li>
                </ul>
              </div>

              <div class="fd-inner">
                <p class="fd-inner-txt">첨부 파일 3</p>

                <ul class="file-list clearfix">
                  <li><a href="">6학년 2학기 수학 II 3단원 .pdf</a></li>
                  <li><a href="">수학 II 3단원 정리 .hwp</a></li>
                  <li><a href="">수학 I 개념 정리.pdf</a></li>
                </ul>
              </div>
            </div>
          </div>

          <div class="popup-feed-comment">
            <div class="comment-top">
              <p>댓글 {{ commentItemsModel.length }}</p>
            </div>
            <div class="comment-cnt">
              <div v-for="(item, idx ) in commentItemsModel" class="comment pdt-0" :key="`comment-${idx}`">
                <div class="main-comment">
                  <p class="comment-writer">{{ item.owner.nickname }} <span class="wr-time">{{ updatedDiffDate(item.createdAt) }}</span></p>
                  <p class="comment-txt">{{ item.comment }}</p>

                  <div class="reply-state">
                    <a href="" class="txt-btn" @click.prevent>답글 {{ item.reply_count }}</a>
                    <a href="" class="txt-btn" @click.prevent="replyInputToggle(idx)">답글달기</a>
                  </div>
                </div>

                <template v-if="replyItemsModel[idx]!==undefined">
                  <div v-for="( replyItem, jdx) in replyItemsModel[idx].comment_list" class="reply" :key="`reply-${jdx}`">
                    <p class="comment-writer">{{ replyItem.owner.nickname }} <span class="wr-time">{{ updatedDiffDate(replyItem.createdAt) }}</span></p>
                    <p class="comment-txt">{{ replyItem.comment }}</p>
                  </div>
                </template>

                <div class="comment-btm reply hide">
                  <input v-model="reply" type="text" class="form-control popup-type sm" placeholder="댓글을 작성해 주세요." style="width:466px;">
                  <a href="" class="txt-btn disabled" @click.prevent="addReply(item.id)">등록</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div slot="footer">
          <div class="comment-btm">
            <button type="button" class="btn only-ico-btn"><img :src="require('@/assets/images/image.svg')" alt=""></button>
            <input v-model="comment" type="text" class="form-control popup-type sm" placeholder="댓글을 작성해 주세요." style="width:466px;">
            <a href="" class="txt-btn disabled" @click.prevent="addComment">등록</a>
          </div>
        </div>
    </modal>
  </transition>
  <!-- end: 공통 팝업 -->
</section>
